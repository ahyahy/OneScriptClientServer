<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<HTML>
<HEAD>
    <TITLE>OneScriptFormsPropertyTag</TITLE>
    <META content="text/html; charset=Windows-1252" http-equiv="Content-Type">
    <LINK rel="stylesheet" type="text/css" href="mainstyle.css">
</HEAD>
<BODY id=bodyID class=dtBODY>
    <DIV id=nsbanner>
        <DIV id=bannerrow1>
            <TABLE class=bannerparthead cellSpacing=0>
                <TBODY>
                    <TR id=hdr>
                        <TD class=runninghead></TD>
                        <TD class=product></TD>
                    </TR>
                </TBODY>
            </TABLE>
        </DIV>
        <DIV id=TitleRow>
            <H1 class=dtH1>Замеры производительности</H1>
        </DIV>
    </DIV>
    <DIV id=nstext>
        <H4 class=dtH4>Подключение клиентов</H4>
        <P>За одну секунду сервер может подключить 1700 клиентов.</P>
        <P></P>
        <details>
            <summary>Код теста подключений:</summary>
            <P>
                <PRE class=code>
<a id="copy1" href="jаvascript://" title="Выделяет код, копирует и снимает выделение.">Копировать</a>     <a id="select1" href="jаvascript://" title="Выделяет код.">Выделить всё</a>
<hr style="border-color: lightgray;"><DIV id="cont1">
// запустите в терминале файл Сервер.os с таким содержимым

Перем КС;

Функция Сервер_ПриПодключенииКлиента() Экспорт
	СерверКлиент = КС.АргументыСобытия.Клиент;
	Сообщить("Подключен новый клиент. Идентификатор клиента = " + СерверКлиент.ИдентификаторКлиента);
	Сообщить("========================================");
КонецФункции

Процедура Сервер_ПриПолученииСообщения() Экспорт
	Сообщение = КС.АргументыСобытия.Сообщение;
	Отправитель = КС.Отправитель;
	ОтправительИдентификаторКлиента = Отправитель.ИдентификаторКлиента;
	Если ("" + Сообщение) = "КсСообщениеТекст" Тогда
		Сообщить("Клиент отправил сообщение: " + Сообщение.Text + " (ИдентификаторКлиента = " + Отправитель.ИдентификаторКлиента + ")");
		Сообщить("========================================");
	ИначеЕсли ("" + Сообщение) = "КсСообщениеБайты" Тогда
		Сообщить("Клиент отправил файл: " + СтрДлина(Сообщение.Данные) + "-" + Отправитель.ИдентификаторКлиента + "-" + Сообщение.Данные);
		// Сообщение.Данные.Записать("C:\777\МойФайл.jpg");
		Сообщить("========================================");
	КонецЕсли;
КонецПроцедуры

Процедура Сервер_ПриОтключенииКлиента() Экспорт
	Сообщить("Клиент отключен! Идентификатор клиента = " + КС.АргументыСобытия.Клиент.ИдентификаторКлиента);
	Сообщить("========================================");
КонецПроцедуры

ПодключитьВнешнююКомпоненту("C:\444\111\OneScriptClientServer\OneScriptClientServer\bin\Debug\OneScriptClientServer.dll");
КС = Новый КлиентСерверДляОдноСкрипта();

TCPСервер1 = КС.TCPСервер(10085);
TCPСервер1.ПриПодключенииКлиента = КС.Действие(ЭтотОбъект, "Сервер_ПриПодключенииКлиента");
TCPСервер1.ПриОтключенииКлиента = КС.Действие(ЭтотОбъект, "Сервер_ПриОтключенииКлиента");
TCPСервер1.ПриПолученииСообщения = КС.Действие(ЭтотОбъект, "Сервер_ПриПолученииСообщения");

// Запустим сервер
TCPСервер1.Начать();
Сообщить("Сервер запущен");

// Запустим цикл обработки событий
Пока КС.Продолжать Цикл
	КС.ПолучитьСобытие().Выполнить();
КонецЦикла;

//==========================================================================================

// Затем запустите в терминале файл Клиент.os с таким содержимым

ПодключитьВнешнююКомпоненту("C:\444\111\OneScriptClientServer\OneScriptClientServer\bin\Debug\OneScriptClientServer.dll");
КС = Новый КлиентСерверДляОдноСкрипта();

Время1 = ТекущаяУниверсальнаяДатаВМиллисекундах();
Для А = 0 По 16000 Цикл
	TCPКлиент1 = КС.TCPКлиент(КС.TCPКонечнаяТочка("127.0.0.1", 10085));
	Попытка
		TCPКлиент1.Подключить();
	Исключение
		Сообщить("А = " + А);
		Прервать;
	КонецПопытки;
КонецЦикла;
Время2 = ТекущаяУниверсальнаяДатаВМиллисекундах();
Сообщить("" + (А - 1) + " клиентов подключено за " + (Время2 - Время1) + " мс");

// TCPКлиент1.Отключить();
// КС.Продолжать = Ложь;

// Запустим цикл обработки событий
Пока КС.Продолжать Цикл
	КС.ПолучитьСобытие().Выполнить();
КонецЦикла;
</DIV>
</PRE>
        </details>
        <P></P>
        <hr style="border-color: lightgray;">
        <H4 class=dtH4>Отправка клиентом сообщений</H4>
        <P>Клиент посылает 15000 коротких текстовых сообщений за одну секунду. Сервер все их асинхронно принимает и обрабатывает.</P>
        <P></P>
        <details>
            <summary>Код теста отправки сообщений:</summary>
            <P>
                <PRE class=code>
<a id="copy2" href="jаvascript://" title="Выделяет код, копирует и снимает выделение.">Копировать</a>     <a id="select2" href="jаvascript://" title="Выделяет код.">Выделить всё</a>
<hr style="border-color: lightgray;"><DIV id="cont2">
// запустите в терминале файл Сервер.os с таким содержимым
Перем КС;

Функция Сервер_ПриПодключенииКлиента() Экспорт
	СерверКлиент = КС.АргументыСобытия.Клиент;
	Сообщить("Подключен новый клиент. Идентификатор клиента = " + СерверКлиент.ИдентификаторКлиента);
	Сообщить("========================================");
КонецФункции

Процедура Сервер_ПриПолученииСообщения() Экспорт
	Сообщение = КС.АргументыСобытия.Сообщение;
	Отправитель = КС.Отправитель;
	ОтправительИдентификаторКлиента = Отправитель.ИдентификаторКлиента;
	Если ("" + Сообщение) = "КсСообщениеТекст" Тогда
		Сообщить("Клиент отправил сообщение: " + Сообщение.Text + " (ИдентификаторКлиента = " + Отправитель.ИдентификаторКлиента + ")");
		Сообщить("========================================");
	ИначеЕсли ("" + Сообщение) = "КсСообщениеБайты" Тогда
		Сообщить("Клиент отправил файл: " + СтрДлина(Сообщение.Данные) + "-" + Отправитель.ИдентификаторКлиента + "-" + Сообщение.Данные);
		// Сообщение.Данные.Записать("C:\777\МойФайл.jpg");
		Сообщить("========================================");
	КонецЕсли;
КонецПроцедуры

Процедура Сервер_ПриОтключенииКлиента() Экспорт
	Сообщить("Клиент отключен! Идентификатор клиента = " + КС.АргументыСобытия.Клиент.ИдентификаторКлиента);
	Сообщить("========================================");
КонецПроцедуры

ПодключитьВнешнююКомпоненту("C:\444\111\OneScriptClientServer\OneScriptClientServer\bin\Debug\OneScriptClientServer.dll");
КС = Новый КлиентСерверДляОдноСкрипта();

TCPСервер1 = КС.TCPСервер(10085);
TCPСервер1.ПриПодключенииКлиента = КС.Действие(ЭтотОбъект, "Сервер_ПриПодключенииКлиента");
TCPСервер1.ПриОтключенииКлиента = КС.Действие(ЭтотОбъект, "Сервер_ПриОтключенииКлиента");
TCPСервер1.ПриПолученииСообщения = КС.Действие(ЭтотОбъект, "Сервер_ПриПолученииСообщения");

// Запустим сервер
TCPСервер1.Начать();
Сообщить("Сервер запущен");

// Запустим цикл обработки событий
Пока КС.Продолжать Цикл
	КС.ПолучитьСобытие().Выполнить();
КонецЦикла;

//==========================================================================================

// Затем запустите в терминале файл Клиент.os с таким содержимым

ПодключитьВнешнююКомпоненту("C:\444\111\OneScriptClientServer\OneScriptClientServer\bin\Debug\OneScriptClientServer.dll");
КС = Новый КлиентСерверДляОдноСкрипта();
TCPКлиент1 = КС.TCPКлиент(КС.TCPКонечнаяТочка("127.0.0.1", 10085));
TCPКлиент1.Подключить();

Время1 = ТекущаяУниверсальнаяДатаВМиллисекундах();
Если TCPКлиент1.СостояниеСоединения = 0 Тогда
	Для А = 0 По 18000 Цикл
		// Отправим сообщение на сервер.
		TCPКлиент1.ОтправитьСообщение(КС.СообщениеТекст("Это " + А + " текстовое сообщение!!!!!!!")); 
	КонецЦикла;
КонецЕсли;
Время2 = ТекущаяУниверсальнаяДатаВМиллисекундах();
Сообщить("" + А + " сообщений отправлено за " + (Время2 - Время1) + " мс");

// TCPКлиент1.Отключить();
// КС.Продолжать = Ложь;

// Запустим цикл обработки событий
Пока КС.Продолжать Цикл
	КС.ПолучитьСобытие().Выполнить();
КонецЦикла;
</DIV>
</PRE>
        </details>
        <P></P>
        <H4 class=dtH4>Смотрите также</H4>
        <P><A href="OSClientServer.html">Библиотека&nbsp;OneScriptClientServer</A></P>
    </DIV>
    <script>
        window.onload = function () {
            var a = document.getElementById('select1');
            a.onclick = function () {
                window.getSelection().removeAllRanges();
                var ta1 = document.getElementById('cont1');
                var range1 = document.createRange();
                range1.selectNode(ta1);
                window.getSelection().addRange(range1);
                return false;
            }

            var b = document.getElementById('copy1');
            b.onclick = function () {
                window.getSelection().removeAllRanges();
                var ta2 = document.getElementById('cont1');
                var range2 = document.createRange();
                range2.selectNode(ta2);
                window.getSelection().addRange(range2);
                try {
                    document.execCommand('copy');
                } catch (err) { }
                window.getSelection().removeRange(range2);
                return false;
            }

            var c = document.getElementById('select2');
            c.onclick = function () {
                window.getSelection().removeAllRanges();
                var ta3 = document.getElementById('cont2');
                var range3 = document.createRange();
                range3.selectNode(ta3);
                window.getSelection().addRange(range3);
                return false;
            }

            var d = document.getElementById('copy2');
            d.onclick = function () {
                window.getSelection().removeAllRanges();
                var ta4 = document.getElementById('cont2');
                var range4 = document.createRange();
                range4.selectNode(ta4);
                window.getSelection().addRange(range4);
                try {
                    document.execCommand('copy');
                } catch (err) { }
                window.getSelection().removeRange(range4);
                return false;
            }
        }
    </script>
</BODY>
</HTML>
